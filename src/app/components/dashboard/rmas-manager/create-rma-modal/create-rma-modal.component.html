<div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4 lg:pl-52">
  <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
    <!-- Header -->
    <div class="bg-gradient-to-r from-purple-600 to-purple-800 text-white p-6 flex justify-between items-center sticky top-0 z-10">
      <h2 class="text-2xl font-bold">Crear Nueva Solicitud (RMA)</h2>
      <button (click)="closeModal()" class="text-white hover:text-gray-200 transition-colors">
        <fa-icon [icon]="faTimes" class="text-2xl"></fa-icon>
      </button>
    </div>

    <!-- Content -->
    <div class="p-6">
      <!-- Error Alert -->
      @if (error(); as errorMsg) {
        <div class="bg-red-100 border-l-4 border-red-500 text-red-800 p-4 rounded-lg mb-4" role="alert">
          <span class="font-medium">Error:</span> {{ errorMsg }}
        </div>
      }

      <!-- Form -->
      <form [formGroup]="createForm" (ngSubmit)="handleSubmit()" class="space-y-6">
        <div>
          <label for="order_id" class="block text-sm font-medium text-gray-700 mb-1">
            ID del Pedido <span class="text-red-500">*</span>
          </label>
          <input 
            type="text" 
            id="order_id" 
            formControlName="order_id" 
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm" 
            placeholder="Ej: ORD-12345" 
          />
          @if (createForm.get('order_id')?.touched && createForm.get('order_id')?.hasError('required')) {
            <p class="mt-1 text-xs text-red-600">El ID del pedido es obligatorio.</p>
          }
          @if (createForm.get('order_id')?.touched && createForm.get('order_id')?.hasError('minlength')) {
            <p class="mt-1 text-xs text-red-600">Debe tener al menos 5 caracteres.</p>
          }
        </div>

        <div>
          <label for="create_motivo" class="block text-sm font-medium text-gray-700 mb-1">
            Motivo <span class="text-red-500">*</span>
          </label>
          <textarea 
            id="create_motivo" 
            formControlName="motivo" 
            rows="4" 
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm" 
            placeholder="Describe el motivo de la devolución...">
          </textarea>
          @if (createForm.get('motivo')?.touched && createForm.get('motivo')?.hasError('required')) {
            <p class="mt-1 text-xs text-red-600">El motivo es obligatorio.</p>
          }
          @if (createForm.get('motivo')?.touched && createForm.get('motivo')?.hasError('minlength')) {
            <p class="mt-1 text-xs text-red-600">Debe tener al menos 10 caracteres.</p>
          }
        </div>

        <div>
          <label for="items" class="block text-sm font-medium text-gray-700 mb-1">
            Items a Devolver (JSON) <span class="text-red-500">*</span>
          </label>
          <textarea 
            id="items" 
            formControlName="items" 
            rows="5" 
            class="block w-full rounded-md border-gray-300 shadow-sm focus:border-purple-500 focus:ring-purple-500 sm:text-sm font-mono" 
            placeholder='Ej: [{"product_id": "SKU123", "quantity": 1}]'>
          </textarea>
          @if (createForm.get('items')?.touched && createForm.get('items')?.hasError('required')) {
            <p class="mt-1 text-xs text-red-600">Los items son obligatorios.</p>
          }
          @if (createForm.get('items')?.hasError('invalidJson')) {
            <p class="mt-1 text-xs text-red-600">El formato de los items no es un JSON válido.</p>
          }
        </div>

        <!-- Actions -->
        <div class="flex justify-end space-x-3 pt-4 border-t">
          <button 
            type="button" 
            (click)="closeModal()" 
            class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors"
            [disabled]="isLoading()">
            Cancelar
          </button>
          <button 
            type="submit" 
            [disabled]="createForm.invalid || isLoading()" 
            class="inline-flex items-center space-x-2 bg-purple-600 text-white px-6 py-2 rounded-lg shadow-md hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-75 transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed">
            @if (isLoading()) {
              <fa-icon [icon]="faSpinner" class="animate-spin"></fa-icon>
            } @else {
              <fa-icon [icon]="faPaperPlane"></fa-icon>
            }
            <span>{{ isLoading() ? 'Creando...' : 'Crear Solicitud' }}</span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
