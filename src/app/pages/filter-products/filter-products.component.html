<div class="flex gap-6 mt-5 h-[85vh]">
  <!-- ASIDE (Sin cambios) -->
  <aside class="w-64 bg-gray-50 border-purple-100 rounded-lg p-4 overflow-y-auto scroll-purple">
    <h3 class="text-lg font-extrabold mb-4 sticky -top-5 bg-gray-50 p-2 text-purple-600">Filtros</h3>
    <ul class="space-y-2">
      <li>
        <button class="w-full text-left px-2 py-1 rounded hover:bg-gray-200" [class.font-bold]="modoTodos"
          (click)="seleccionarFiltro(null)">
          Todas
        </button>
      </li>

      <li *ngFor="let cat of categorias">
        <div class="font-medium text-gray-700">
          {{ cat.category }}
        </div>
        <ul class="ml-3 mt-1 space-y-1">
          <li>
            <button class="text-sm text-left px-2 py-1 rounded hover:bg-gray-200" [class.font-bold]="
              seleccionCategoria === cat.category && !seleccionSubcategoria
            " (click)="seleccionarFiltro(cat.category)">
              Todos en {{ cat.category }}
            </button>
          </li>
          <li *ngFor="let sub of cat.subCategories">
            <button class="text-sm text-left px-2 py-1 rounded hover:bg-gray-200" [class.font-bold]="
              seleccionCategoria === cat.category &&
              seleccionSubcategoria === sub
            " (click)="seleccionarFiltro(cat.category, sub)">
              {{ sub }}
            </button>
          </li>
        </ul>
      </li>
    </ul>
  </aside>

  <!-- t+item de carrito -->
  <div *ngIf="cartItemCount > 0 && islogged"
    class="fixed flex justify-center bottom-2 rounded-tl-xl rounded-bl-xl right-0 md:left-auto bg-purple-500 text-white animate__animated animate__fadeInRight shadow-lg w-18 h-15 z-10">
    <a routerLink="/productos/cart" class="relative flex items-center justify-center w-full h-full">
      <span
        class="p-2 absolute top-2 right-2 bg-purple-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
        {{ cartItemCount }}
      </span>
      <fa-icon [icon]="faShoppingCart" class="text-xl md:text-2xl "></fa-icon>
    </a>
  </div>

  <div class="flex-1 mt-2 overflow-y-auto overflow-x-hidden" (scroll)="onProductScroll($event)">
    <div class="flex justify-between px-4 sticky -top-1 z-10 p-2 bg-white">
      <h2 class="text-md font-bold mb-6">{{ tituloVista }}</h2>
      <h2 class="text-sm mb-6 text-purple-500">Ocultar filtros <fa-icon [icon]="faFilters"></fa-icon></h2>
    </div>


    <!-- 1. SKELETON LOADER -->
    <!-- Se muestra solo cuando 'cargando' es true -->
    <!-- Repetimos el componente varias veces para simular la cuadrÃ­cula de carga -->
    <div *ngIf="cargando" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <app-skeleton-filter-product *ngFor="let i of [1, 2, 3, 4, 5, 6]"></app-skeleton-filter-product>
    </div>

    <!-- Se muestra solo cuando 'cargando' es false -->
    <div *ngIf="!cargando" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <app-product-advance (agregarAlCarrito)="onComprarProductos(producto)" *ngFor="let producto of productos"
        [producto]="producto"></app-product-advance>
    </div>
  </div>

  <lib-toastify-toast-container></lib-toastify-toast-container>

  <div *ngIf="createUser" class="bg-black/60 backdrop-blur-sm fixed top-0 z-50 w-full h-full overflow-hidden"
    (click)="onOutregister()">
    <app-create-user></app-create-user>
  </div>

  <div *ngIf="comprarProductos" class="bg-black/50 fixed top-0 z-50 w-full h-full flex overflow-hidden">
    <app-info-login *ngIf="comprarProductos" (close)="onComprarProductos(null)" (loginAction)="handleLogin()"
      (createAction)="handleCreate()">
    </app-info-login>
  </div>
</div>
