<!-- advance-chat.component.html -->
<div class="flex flex-col h-dvh w-full bg-gray-50 text-gray-800 transition-all duration-300">

  <!-- VISTA DE BIENVENIDA CON ANIMACIÓN -->
  <div *ngIf="messages().length === 0"
    class="flex flex-col flex-1 items-center justify-center px-4 space-y-10 animate__animated animate__fadeIn">

    <!-- LOGO CON EFECTO SUAVE -->
    <div class="w-28 h-20 flex items-center justify-center group">
      <div class="w-16 h-16 rounded-full flex items-center justify-center group-hover:rotate-12 transition-transform duration-300">
        <img src="imagelogo.png" alt="Logo de Advance AI" class="w-12 h-12 animate-pulse">
      </div>
    </div>

    <!-- INPUT CENTRAL CON SOMBRAS SUAVES -->
    <div class="w-full max-w-xl">
      <form (ngSubmit)="sendMessage()" class="relative group">
        <input [ngModel]="messageText()"
               (ngModelChange)="messageText.set($event)"
               type="text"
               name="message"
               placeholder="¿En qué puedo ayudarte hoy?"
               class="w-full px-6 py-4 bg-white text-gray-900 placeholder-gray-400 rounded-2xl focus:outline-none focus:ring-2 focus:ring-purple-300 shadow-md transition-all duration-300 group-hover:shadow-lg" />
        <button type="submit"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-purple-400 hover:text-purple-600 transition-colors duration-200">
          <fa-icon [icon]="faPaperPlane" class="animate__animated animate__heartBeat"></fa-icon>
        </button>
      </form>
    </div>

    <!-- OPCIONES SUGERIDAS CON TARJETAS -->
    <div class="space-y-3 text-left w-full max-w-lg">
      <h3 class="text-sm font-medium text-purple-600 mb-2">Sugerencias rápidas</h3>
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
        <div *ngFor="let action of quickActions"
             (click)="sendQuickMessage(action)"
             class="border border-gray-200 rounded-xl px-4 py-3 hover:bg-purple-50 hover:border-purple-200 transition-all duration-200 cursor-pointer shadow-sm hover:shadow">
          <fa-icon [icon]="faCommentDots" class="mr-2 text-purple-400"></fa-icon>
          <span class="text-gray-700 text-sm">{{ action }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- VISTA DE CHAT CON DISEÑO MODERNO -->
  <div *ngIf="messages().length > 0" class="flex flex-col h-full">
    <!-- HEADER CON GRADIENTE SUTIL -->
    <div class="bg-gradient-to-r from-purple-600 to-indigo-700 text-white p-4 shadow-md sticky top-0 z-10">
      <h1 class="text-xl font-bold flex items-center">
        <fa-icon [icon]="faRobot" class="mr-2"></fa-icon>
        Advance Chat
      </h1>
    </div>

    <!-- ÁREA DE MENSAJES CON SCROLL SUAVE -->
    <div class="flex-1 overflow-y-auto px-4 pt-4 space-y-6 pb-16 scrollbar-thin"
         #messagesContainer>

      <ng-container *ngFor="let msg of getAllMessagesInOrder(); trackBy: trackByMessageId">
        <div [ngClass]="msg.isUser ? 'justify-end' : 'justify-start'"
             class="flex">

          <!-- MENSAJE USUARIO CON ANIMACIÓN -->
          <div *ngIf="msg.isUser"
               class="max-w-xs sm:max-w-md bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-2xl rounded-tr-sm px-5 py-4 shadow-md transform transition-all duration-300 hover:scale-[1.02]">
            <div class="font-medium mb-1">{{ msg.content }}</div>
            <div class="flex items-center justify-end space-x-2 text-xs opacity-90 mt-1">
              <span>{{ getTimeString(msg.timestamp) }}</span>
              <span [ngClass]="getIconClass(msg.state)">
                <fa-icon [icon]="getMessageIcon(msg.state)"></fa-icon>
              </span>
            </div>
          </div>

          <!-- RESPUESTA AI CON DETALLES -->
          <div *ngIf="!msg.isUser"
               class="max-w-xs sm:max-w-md bg-white text-gray-800 border border-gray-200 rounded-2xl rounded-tl-sm px-5 py-4 shadow-sm">
            <div class="flex items-start space-x-3">
              <div class="w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center flex-shrink-0 animate-pulse">
                <fa-icon [icon]="faRobot" class="text-white"></fa-icon>
              </div>
              <div class="flex-1">
                <div class="text-sm font-semibold text-purple-700 mb-1">Advance AI</div>
                <div class="text-gray-900 leading-relaxed whitespace-pre-line">{{ msg.content }}</div>
                <div class="text-xs text-gray-500 mt-2 text-right">{{ getTimeString(msg.timestamp) }}</div>
              </div>
            </div>
          </div>
        </div>
      </ng-container>

      <!-- INDICADOR DE ESCRITURA CON ANIMACIÓN -->
      <div *ngIf="isTyping()" class="flex items-center space-x-2 text-sm text-gray-500 animate-pulse">
        <fa-icon [icon]="faEllipsis" class="text-purple-400"></fa-icon>
        <span>Escribiendo...</span>
      </div>
    </div>

    <!-- INPUT CON DISEÑO FLOTANTE -->
    <div class="bg-white p-4 border-t border-gray-200 shadow-lg sticky bottom-0">
      <form (ngSubmit)="sendMessage()" class="flex items-center space-x-3">
        <div class="relative flex-1">
          <input [ngModel]="messageText()"
                 (ngModelChange)="messageText.set($event)"
                 type="text"
                 name="message"
                 placeholder="Escribe tu mensaje..."
                 class="w-full px-5 py-3 bg-gray-100 text-gray-900 placeholder-gray-400 rounded-full focus:outline-none focus:ring-2 focus:ring-purple-300 transition-all duration-200" />
          <fa-icon [icon]="faLightbulb" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400" *ngIf="messageText().length === 0"></fa-icon>
        </div>
        <button type="submit"
                class="w-10 h-10 bg-gradient-to-r from-purple-500 to-indigo-600 hover:from-purple-600 hover:to-indigo-700 text-white rounded-full flex items-center justify-center shadow-md transition-all duration-200 transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"
                [disabled]="!messageText().trim()">
          <fa-icon [icon]="faPaperPlane"></fa-icon>
        </button>
      </form>
    </div>
  </div>
</div>
